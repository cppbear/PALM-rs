callers have to ensure map is allocated