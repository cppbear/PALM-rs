{
    "function_name": "bytes::bytes::release_shared",
    "tests": 4,
    "tests_lines": [
        32,
        29,
        36,
        30
    ],
    "oracles": 4,
    "oracles_compiled": 2,
    "oracles_compiled_rate": 50.0,
    "tests_compiled": 2,
    "tests_compiled_rate": 50.0,
    "oracles_run": 2,
    "oracles_passed": 2,
    "oracles_passed_rate": 100.0,
    "tests_run": 2,
    "tests_passed": 2,
    "tests_passed_rate": 100.0,
    "lines": 31,
    "lines_covered": 31,
    "lines_coveraged_rate": 100.0,
    "branches": 2,
    "branches_covered": 2,
    "branches_coverage_rate": 100.0,
    "codes_lines": [
        1564,
        1565,
        1566,
        1567,
        1568,
        1569,
        1570,
        1571,
        1572,
        1573,
        1574,
        1575,
        1576,
        1577,
        1578,
        1579,
        1580,
        1581,
        1582,
        1583,
        1584,
        1585,
        1586,
        1587,
        1588,
        1589,
        1590,
        1591,
        1592,
        1593,
        1594
    ],
    "codes_lines_covered": [
        [
            [
                "{",
                "   use core::ptr::null_mut;  ",
                "   use core::sync::atomic::AtomicUsize;  ",
                "   use alloc::boxed::Box;  ",
                " ",
                "   struct Shared {  ",
                "       buf: *mut u8,  ",
                "       cap: usize,  ",
                "       ref_cnt: AtomicUsize,  ",
                "   }  ",
                " ",
                "   // Create a Shared instance with a non-zero reference count  ",
                "   let shared = Box::new(Shared {  ",
                "       buf: null_mut(),  ",
                "       cap: 0,  ",
                "       ref_cnt: AtomicUsize::new(2), // Set reference count to 2  ",
                "   });  ",
                " ",
                "   // Convert the Box to a raw pointer  ",
                "   let ptr = Box::into_raw(shared);  ",
                " ",
                "   unsafe {  ",
                "       // Call release_shared function  ",
                "       release_shared(ptr as *mut super::Shared); // This should decrease ref_cnt to 1 and not drop the shared instance  ",
                " ",
                "       // Verify that the reference count is still greater than zero  ",
                "       assert_eq!((*ptr).ref_cnt.load(core::sync::atomic::Ordering::Relaxed), 1);  ",
                " ",
                "       // Cleanup: properly release the reference by calling release_shared again  ",
                "       release_shared(ptr as *mut super::Shared); // This should decrement ref_cnt to 0 and drop the shared instance  ",
                "   }  ",
                "}"
            ],
            [
                1564,
                1565,
                1566,
                1567,
                1568,
                1569,
                1570,
                1571,
                1572,
                1573,
                1574,
                1575,
                1576,
                1577,
                1578,
                1579,
                1580,
                1581,
                1582,
                1583,
                1584,
                1585,
                1586,
                1587,
                1588,
                1589,
                1590,
                1591,
                1592,
                1593,
                1594
            ]
        ],
        [
            [
                "{",
                "    use core::ptr::null_mut;",
                "   use alloc::alloc::{alloc, Layout};  ",
                "",
                "    struct TestShared {",
                "        buf: *mut u8,",
                "        cap: usize,",
                "        ref_cnt: AtomicUsize,",
                "    }",
                "",
                "    unsafe fn create_shared(capacity: usize) -> *mut TestShared {",
                "        let layout = Layout::from_size_align(std::mem::size_of::<TestShared>(), std::mem::align_of::<TestShared>()).unwrap();",
                "        let ptr = alloc(layout) as *mut TestShared;",
                "",
                "        (*ptr) = TestShared {",
                "            buf: null_mut(), // No allocation for the buffer since we are testing reference count behavior",
                "            cap: capacity,",
                "            ref_cnt: AtomicUsize::new(2), // Initialize reference count to 2 to satisfy the test condition",
                "        };",
                "",
                "        ptr",
                "    }",
                "",
                "   unsafe {",
                "       let shared_ptr = create_shared(0) as *mut Shared; // Cast to *mut Shared",
                "       ",
                "       // Call the function, it should not drop the shared object as ref_cnt is 2",
                "       release_shared(shared_ptr);",
                "       ",
                "       // Verify that the reference count was decremented correctly",
                "       assert_eq!((*shared_ptr).ref_cnt.load(Ordering::Relaxed), 1);",
                "       ",
                "       // Cleanup: Call release_shared again to clean up",
                "       release_shared(shared_ptr);",
                "    }",
                "}"
            ],
            [
                1564,
                1565,
                1566,
                1567,
                1568,
                1569,
                1570,
                1571,
                1572,
                1573,
                1574,
                1575,
                1576,
                1577,
                1578,
                1579,
                1580,
                1581,
                1582,
                1583,
                1584,
                1585,
                1586,
                1587,
                1588,
                1589,
                1590,
                1591,
                1592,
                1593,
                1594
            ]
        ]
    ],
    "codes_branches": [
        {
            "start_line": 1566,
            "start_column": 8,
            "end_line": 1566,
            "end_column": 59,
            "positive": true,
            "negative": true
        }
    ],
    "codes_branches_covered": [
        [
            [
                "{",
                "   use core::ptr::null_mut;  ",
                "   use core::sync::atomic::AtomicUsize;  ",
                "   use alloc::boxed::Box;  ",
                " ",
                "   struct Shared {  ",
                "       buf: *mut u8,  ",
                "       cap: usize,  ",
                "       ref_cnt: AtomicUsize,  ",
                "   }  ",
                " ",
                "   // Create a Shared instance with a non-zero reference count  ",
                "   let shared = Box::new(Shared {  ",
                "       buf: null_mut(),  ",
                "       cap: 0,  ",
                "       ref_cnt: AtomicUsize::new(2), // Set reference count to 2  ",
                "   });  ",
                " ",
                "   // Convert the Box to a raw pointer  ",
                "   let ptr = Box::into_raw(shared);  ",
                " ",
                "   unsafe {  ",
                "       // Call release_shared function  ",
                "       release_shared(ptr as *mut super::Shared); // This should decrease ref_cnt to 1 and not drop the shared instance  ",
                " ",
                "       // Verify that the reference count is still greater than zero  ",
                "       assert_eq!((*ptr).ref_cnt.load(core::sync::atomic::Ordering::Relaxed), 1);  ",
                " ",
                "       // Cleanup: properly release the reference by calling release_shared again  ",
                "       release_shared(ptr as *mut super::Shared); // This should decrement ref_cnt to 0 and drop the shared instance  ",
                "   }  ",
                "}"
            ],
            [
                {
                    "start_line": 1566,
                    "start_column": 8,
                    "end_line": 1566,
                    "end_column": 59,
                    "positive": true,
                    "negative": true
                }
            ]
        ],
        [
            [
                "{",
                "    use core::ptr::null_mut;",
                "   use alloc::alloc::{alloc, Layout};  ",
                "",
                "    struct TestShared {",
                "        buf: *mut u8,",
                "        cap: usize,",
                "        ref_cnt: AtomicUsize,",
                "    }",
                "",
                "    unsafe fn create_shared(capacity: usize) -> *mut TestShared {",
                "        let layout = Layout::from_size_align(std::mem::size_of::<TestShared>(), std::mem::align_of::<TestShared>()).unwrap();",
                "        let ptr = alloc(layout) as *mut TestShared;",
                "",
                "        (*ptr) = TestShared {",
                "            buf: null_mut(), // No allocation for the buffer since we are testing reference count behavior",
                "            cap: capacity,",
                "            ref_cnt: AtomicUsize::new(2), // Initialize reference count to 2 to satisfy the test condition",
                "        };",
                "",
                "        ptr",
                "    }",
                "",
                "   unsafe {",
                "       let shared_ptr = create_shared(0) as *mut Shared; // Cast to *mut Shared",
                "       ",
                "       // Call the function, it should not drop the shared object as ref_cnt is 2",
                "       release_shared(shared_ptr);",
                "       ",
                "       // Verify that the reference count was decremented correctly",
                "       assert_eq!((*shared_ptr).ref_cnt.load(Ordering::Relaxed), 1);",
                "       ",
                "       // Cleanup: Call release_shared again to clean up",
                "       release_shared(shared_ptr);",
                "    }",
                "}"
            ],
            [
                {
                    "start_line": 1566,
                    "start_column": 8,
                    "end_line": 1566,
                    "end_column": 59,
                    "positive": true,
                    "negative": true
                }
            ]
        ]
    ],
    "file_path": "/home/abezbm/rusty-unit/evaluation/bytes/rusty-unit-0/src/bytes.rs"
}